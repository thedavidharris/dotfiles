{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# Run brew bundle using the Brewfile from ~/.config/brew/
# This script runs after files are applied when packages.yaml changes
# packages.yaml hash: {{ .packages | toJson | sha256sum }}

set -euo pipefail

BREWFILE="$HOME/.config/brew/Brewfile"

if [[ ! -f "$BREWFILE" ]]; then
    echo "âŒ Brewfile not found at: $BREWFILE"
    echo "This is unexpected since files should be applied first."
    echo "You can manually run: brew-bundle install"
    exit 1
fi

echo "ðŸº Running brew bundle from $BREWFILE..."
brew bundle --file="$HOME/Brewfile" || { rc=$?; echo >&2 "warning: 'brew bundle' finished with errors (exit code $rc). Continuing chezmoi tasks."; }

echo "âœ… Brew bundle completed"
{{ end -}}
