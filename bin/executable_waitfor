#!/usr/bin/env bash
# =============================================================================
# Wait For Process
# Wait for a process to complete, preventing system sleep
# =============================================================================
# Usage: waitfor <pid>
# Example: waitfor 12345
#
# Description:
#   Waits for a process to complete. On macOS, prevents system sleep
#   using caffeinate. On Linux, uses systemd-inhibit.

set -euo pipefail

if [[ $# -eq 0 ]]; then
  echo "Usage: waitfor <pid>" >&2
  exit 1
fi

pid="$1"

if hash caffeinate 2>/dev/null; then
  caffeinate -w "$pid"
elif hash systemd-inhibit 2>/dev/null; then
  systemd-inhibit \
    --who=waitfor \
    --why="Awaiting PID $pid" \
    tail --pid="$pid" -f /dev/null
else
  tail --pid="$pid" -f /dev/null
fi
